# $Id: Makefile.in,v 1.4 2006/09/28 06:44:36 roman Exp $
# ===========================================================================
#
# Makefile for libchaos/src subdirectory
#
# relative directories
# ---------------------------------------------------------------------------
srcdir       = @srcdir@
top_srcdir   = @top_srcdir@
top_builddir = @top_builddir@
thisdir      = src/

VPATH        = $(srcdir)

# include global make configuration
# ---------------------------------------------------------------------------
include $(top_builddir)/config.mk

# configuration for this directory
# ---------------------------------------------------------------------------
LIBNAME     = $(PACKAGE)
A_LIBRARY   = $(LIBNAME).$(A_EXEEXT)
#PIE_LIBRARY = $(PIE_NAME)$(PIE_VERSION_PREFIX).$(PIE_LIBEXT)$(PIE_VERSION_SUFFIX)
@SHARED_TRUE@PIE_LIBRARY = $(PIE_NAME).$(PIE_LIBEXT)
MODULES     = cfg \
              child \
              connect \
              db \
              divdi3 \
              dlink \
              filter \
              gif \
              graph \
              hook \
              htmlp \
              httpc \
              image \
              ini \
              io \
              listen \
              log \
              mem \
              mfile \
              module \
              net \
              queue \
              sauth \
              ssl \
              str \
              syscall \
              timer \
              ttf \
              $(PIE_LOADER)

PIE_LOADER  = @PIE_LOADER@

SOURCES     = $(MODULES:%=%.c)
OBJECTS     = $(MODULES:%=%.@OBJEXT@)
PIC_OBJECTS = $(MODULES:%=%.@PIC_OBJEXT@)
DEPS        = $(MODULES:%=%.d)

SYS_SOURCES = dlfcn_darwin.c dlfcn_win32.c

CONFIG_H_IN  = $(top_srcdir)/include/libchaos/config.h.in
CONFIG_H     = $(top_builddir)/include/libchaos/config.h
CONFIG_H_TOP = include/libchaos/config.h

#PIE_DEF = $(srcdir)/libchaos.def
#PIE_DEF = libchaos.def
@WIN32_TRUE@PIE_LDFLAGS += -Wl,--out-implib,lib$(PIE_NAME).a

@WIN32_TRUE@@SHARED_TRUE@bin_EXEC = chaos.dll

LIBS     += $(DLFCN_LIBS)

LIBS     += $(SSL_LIBS)
INCLUDES += $(SSL_CFLAGS)

# targets for this directory
# ---------------------------------------------------------------------------
all: Makefile a-library pie-library

install: install-exec install-data

# dependencies
# ---------------------------------------------------------------------------
@DEPS_TRUE@-include $(DEPS)

# install config
# ---------------------------------------------------------------------------
@STATIC_TRUE@lib_DATA += $(A_LIBRARY)
@WIN32_TRUE@@SHARED_TRUE@bin_EXEC += $(PIE_LIBRARY)
@WIN32_FALSE@@SHARED_TRUE@lib_EXEC += $(PIE_LIBRARY)

# build config
# ---------------------------------------------------------------------------
CPPFLAGS += -DPLUGINDIR=\"$(plugindir)\" -DDLLEXT=\"$(PIE_LIBEXT)\" -DBUILD_LIBCHAOS
FILES    += $(SYS_SOURCES)
INCLUDES += -I$(thisdir) \
            -I$(top_srcdir)/include \
            -I. \
            -I$(top_builddir)/include 

CFLAGS   += $(MYSQL_CFLAGS) $(PSQL_CFLAGS) $(SSL_CFLAGS)

@STATIC_TRUE@$(A_LIBRARY): CPPFLAGS += -DSTATIC_LIBCHAOS

# include global make targets
# ---------------------------------------------------------------------------
include $(top_builddir)/build.mk

